<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Cobros Inteligente V5 - Seguimiento Automático</title>
    <meta name="description" content="Sistema profesional de cobros con IA y seguimiento automático para corredores de seguros">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'><text y='32' font-size='32'>💼</text></svg>">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .pro-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(231, 76, 60, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(231, 76, 60, 0); }
            100% { box-shadow: 0 0 0 0 rgba(231, 76, 60, 0); }
        }

        .nav-tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
            overflow-x: auto;
            flex-wrap: wrap;
        }

        .nav-tab {
            flex: 1;
            min-width: 140px;
            padding: 15px 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
            white-space: nowrap;
        }

        .nav-tab:hover {
            background: #e9ecef;
        }

        .nav-tab.active {
            background: white;
            color: #3498db;
            border-bottom-color: #3498db;
        }

        .tab-content {
            display: none;
            padding: 30px;
        }

        .tab-content.active {
            display: block;
        }

        .upload-btn {
            background: #3498db;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px;
        }

        .upload-btn:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }

        .upload-btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            text-align: center;
            border-left: 5px solid #3498db;
            position: relative;
            overflow: hidden;
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .stat-label {
            color: #7f8c8d;
            font-size: 14px;
            text-transform: uppercase;
            font-weight: 500;
        }

        .alert {
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
            font-weight: 500;
            position: relative;
        }

        .alert-success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .alert-warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        .alert-error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .alert-info { background: #d1ecf1; color: #0c5460; border: 1px solid #b8daff; }

        .seguimiento-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .timeline-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .timeline-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #3498db;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .data-table th {
            background: #34495e;
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 500;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .data-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
            vertical-align: top;
        }

        .data-table tr:hover {
            background: #f8f9fa;
        }

        .ai-score-circle {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            color: white;
            font-weight: bold;
            font-size: 14px;
            margin: 0 auto;
        }

        .priority-high {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }

        .priority-medium {
            background: linear-gradient(135deg, #f39c12, #e67e22);
        }

        .priority-low {
            background: linear-gradient(135deg, #27ae60, #229954);
        }

        .action-btn {
            padding: 6px 12px;
            margin: 2px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }

        .btn-email { background: #e74c3c; color: white; }
        .btn-whatsapp { background: #25d366; color: white; }
        .btn-paid { background: #27ae60; color: white; }

        .status-badge {
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .status-pendiente { background: #fff3cd; color: #856404; }
        .status-seguimientoauto { background: #e2e3ff; color: #3730a3; }
        .status-pagado { background: #d4edda; color: #155724; }
        .status-vencido { background: #f8d7da; color: #721c24; }

        .notification-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            max-width: 400px;
            z-index: 1000;
        }

        .notification {
            background: white;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-left: 5px solid #3498db;
            margin-bottom: 10px;
            animation: slideIn 0.3s ease;
        }

        .notification.payment { border-left-color: #27ae60; }
        .notification.alert { border-left-color: #f39c12; }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }

        .form-control {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #2c3e50;
        }

        @media (max-width: 768px) {
            .nav-tabs {
                flex-wrap: wrap;
            }
            
            .nav-tab {
                flex: none;
                min-width: 120px;
                font-size: 12px;
                padding: 12px 15px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr 1fr;
            }
            
            .stat-number {
                font-size: 1.8em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="pro-badge">🚀 V5 COMPLETO</div>
            <h1>💼 Sistema de Cobros Inteligente V5</h1>
            <p>Sistema Profesional con Seguimiento Automático - Costa Rica</p>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="cambiarTab('dashboard')">📊 Dashboard</button>
            <button class="nav-tab" onclick="cambiarTab('carga')">📥 Cargar Datos</button>
            <button class="nav-tab" onclick="cambiarTab('cartera')">📋 Gestión Cartera</button>
            <button class="nav-tab" onclick="cambiarTab('seguimiento')">🤖 Seguimiento Auto</button>
            <button class="nav-tab" onclick="cambiarTab('comprobantes')">📄 Comprobantes</button>
            <button class="nav-tab" onclick="cambiarTab('comunicacion')">📧 Comunicación</button>
            <button class="nav-tab" onclick="cambiarTab('reportes')">📊 Reportes</button>
            <button class="nav-tab" onclick="cambiarTab('configuracion')">⚙️ Configuración</button>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <h2>📊 Dashboard Principal</h2>
            
            <div class="seguimiento-card">
                <h3>🤖 Sistema de Seguimiento Automático</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 20px; margin-top: 15px;">
                    <div style="text-align: center;">
                        <div style="font-size: 2em; font-weight: bold;">ACTIVO</div>
                        <div style="opacity: 0.8;">Estado del Sistema</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 2em; font-weight: bold;">28</div>
                        <div style="opacity: 0.8;">En Seguimiento</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 2em; font-weight: bold;">847</div>
                        <div style="opacity: 0.8;">Mensajes Hoy</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 2em; font-weight: bold;">89%</div>
                        <div style="opacity: 0.8;">Efectividad</div>
                    </div>
                </div>
            </div>

            <div class="alert alert-warning">
                <h4>🔔 Alertas en Tiempo Real</h4>
                <div style="margin-top: 10px;">
                    <div class="timeline-item">
                        <div class="timeline-dot" style="background: #27ae60;"></div>
                        <span><strong>María González</strong> reportó pago - Solicitar comprobante</span>
                        <span style="margin-left: auto; font-size: 12px; color: #666;">Hace 2 min</span>
                    </div>
                    <div class="timeline-item">
                        <div class="timeline-dot" style="background: #f39c12;"></div>
                        <span><strong>Carlos Ramírez</strong> no responde - 15 intentos automáticos</span>
                        <span style="margin-left: auto; font-size: 12px; color: #666;">Hace 1 hora</span>
                    </div>
                    <div class="timeline-item">
                        <div class="timeline-dot" style="background: #3498db;"></div>
                        <span><strong>Ana Vega</strong> subió comprobante - Verificar</span>
                        <span style="margin-left: auto; font-size: 12px; color: #666;">Hace 3 horas</span>
                    </div>
                </div>
            </div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number">4</div>
                    <div class="stat-label">Total Clientes</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">₡1,365,000</div>
                    <div class="stat-label">Monto Pendiente</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">1</div>
                    <div class="stat-label">Vencidos</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">69%</div>
                    <div class="stat-label">Score Promedio</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">2</div>
                    <div class="stat-label">Seguimiento Activo</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">1</div>
                    <div class="stat-label">Comprobantes Pendientes</div>
                </div>
            </div>
        </div>

        <!-- Tab Carga de Datos -->
        <div id="carga" class="tab-content">
            <h2>📥 Carga de Datos Excel</h2>
            
            <div style="background: #e8f5e8; padding: 20px; border-radius: 10px; margin-bottom: 30px; border-left: 5px solid #27ae60;">
                <h3>📋 Plantillas Disponibles</h3>
                <p>Descarga una plantilla con el formato correcto:</p>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 15px;">
                    <button class="upload-btn" onclick="descargarPlantilla('vacia')" style="background: #27ae60;">
                        📋 Plantilla Vacía
                        <br><small style="opacity: 0.8;">Con campos USD/CRC y vehículos</small>
                    </button>
                    <button class="upload-btn" onclick="descargarPlantilla('ejemplo')" style="background: #3498db;">
                        📊 Ejemplo con Datos
                        <br><small style="opacity: 0.8;">Incluye autos y dólares</small>
                    </button>
                    <button class="upload-btn" onclick="descargarPlantilla('ins')" style="background: #e74c3c;">
                        🏢 Solo INS
                        <br><small style="opacity: 0.8;">Específica para INS</small>
                    </button>
                </div>
            </div>

            <div style="border: 3px dashed #3498db; border-radius: 10px; padding: 40px; text-align: center; margin-bottom: 30px;">
                <h3>📁 Sube tu archivo Excel de cartera</h3>
                <p>Formatos soportados: .xlsx, .xls</p>
                <p>El sistema detectará automáticamente: Cliente, Aseguradora, Monto, Moneda, Placa, Marca</p>
                <input type="file" id="fileInput" accept=".xlsx,.xls" onchange="cargarExcel(this)" style="display: none;">
                <button type="button" class="upload-btn" onclick="document.getElementById('fileInput').click()">Seleccionar Archivo Excel</button>
            </div>

            <div id="fileInfo" style="display: none;">
                <div class="alert alert-success">
                    <strong>📊 Archivo procesado exitosamente</strong><br>
                    <strong>📈 Registros encontrados:</strong> <span id="recordCount">0</span><br>
                    <strong>🤖 Seguimiento automático:</strong> <span style="color: #27ae60; font-weight: bold;">ACTIVADO</span>
                </div>
            </div>

            <button onclick="activarSistema()" class="upload-btn" id="processBtn" style="opacity: 0.5;" disabled>
                🤖 Activar Sistema de Seguimiento Automático
            </button>
        </div>

        <!-- Tab Gestión Cartera -->
        <div id="cartera" class="tab-content">
            <h2>📋 Gestión de Cartera</h2>
            
            <div style="text-align: right; margin-bottom: 15px;">
                <button class="upload-btn" onclick="exportarDatos()" style="background: #27ae60;">📊 Exportar Excel</button>
                <button class="upload-btn" onclick="comunicacionMasiva()" style="background: #e74c3c;">🚀 Comunicación Masiva</button>
            </div>

            <div style="overflow-x: auto;">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Cliente / Asegurado</th>
                            <th>Score IA</th>
                            <th>Póliza / Aseguradora</th>
                            <th>Monto</th>
                            <th>Vencimiento</th>
                            <th>Estado</th>
                            <th>Seguimiento</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>
                                <strong>María González Castro</strong><br>
                                <small style="color: #666;">🚗 ABC-123 Toyota</small>
                            </td>
                            <td style="text-align: center;">
                                <div class="ai-score-circle priority-high">85%</div>
                            </td>
                            <td>
                                <strong>0104AUT0261819-00</strong><br>
                                <small style="color: #666;">INS</small><br>
                                <small style="color: #3498db;">AUTO</small>
                            </td>
                            <td style="font-weight: bold;">
                                ₡45,000<br>
                                <small style="color: #666;">CRC</small>
                            </td>
                            <td style="color: #e74c3c; font-weight: bold;">
                                15/12/2024<br>
                                <small>Vencido 5 días</small>
                            </td>
                            <td>
                                <span class="status-badge status-seguimientoauto">🤖 SEGUIMIENTO AUTO</span>
                            </td>
                            <td>
                                <small>8 intentos</small><br>
                                <small style="color: #3498db;">Próximo: 11/12 09:00</small>
                            </td>
                            <td>
                                <button class="action-btn btn-email" onclick="enviarEmail(1)">📧</button>
                                <button class="action-btn btn-whatsapp" onclick="enviarWhatsApp(1)">💬</button>
                                <button class="action-btn btn-paid" onclick="marcarPagado(1)">✅</button>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <strong>Carlos Ramírez Soto</strong>
                            </td>
                            <td style="text-align: center;">
                                <div class="ai-score-circle priority-medium">25%</div>
                            </td>
                            <td>
                                <strong>0104RCG0000138-08</strong><br>
                                <small style="color: #666;">INS</small><br>
                                <small style="color: #3498db;">RCG</small>
                            </td>
                            <td style="font-weight: bold;">
                                $1,250<br>
                                <small style="color: #666;">USD</small>
                            </td>
                            <td style="color: #e74c3c; font-weight: bold;">
                                08/12/2024<br>
                                <small>Vencido 12 días</small>
                            </td>
                            <td>
                                <span class="status-badge status-vencido">❌ VENCIDO</span>
                            </td>
                            <td>
                                <small>15 intentos</small><br>
                                <small style="color: #e74c3c;">Sin respuesta</small>
                            </td>
                            <td>
                                <button class="action-btn btn-email" onclick="enviarEmail(2)">📧</button>
                                <button class="action-btn btn-whatsapp" onclick="enviarWhatsApp(2)">💬</button>
                                <button class="action-btn btn-paid" onclick="marcarPagado(2)">✅</button>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <strong>Ana Patricia Vega</strong>
                            </td>
                            <td style="text-align: center;">
                                <div class="ai-score-circle priority-low">95%</div>
                            </td>
                            <td>
                                <strong>0105VID0312456-02</strong><br>
                                <small style="color: #666;">Mapfre Costa Rica</small><br>
                                <small style="color: #3498db;">VIDA</small>
                            </td>
                            <td style="font-weight: bold;">
                                $750<br>
                                <small style="color: #666;">USD</small>
                            </td>
                            <td style="color: #27ae60;">
                                10/01/2025<br>
                                <small>30 días restantes</small>
                            </td>
                            <td>
                                <span class="status-badge status-pagado">✅ PAGADO</span>
                            </td>
                            <td>
                                <small>Completado</small><br>
                                <small style="color: #27ae60;">Comprobante OK</small>
                            </td>
                            <td>
                                <button class="action-btn" style="background: #27ae60; color: white;" disabled>✅</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Tab Seguimiento Automático -->
        <div id="seguimiento" class="tab-content">
            <h2>🤖 Sistema de Seguimiento Automático</h2>
            
            <div style="background: white; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); padding: 25px; margin-bottom: 25px;">
                <h3>⚙️ Control Principal del Sistema</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 20px;">
                    <div style="text-align: center; padding: 15px; background: #f8f9fa; border-radius: 10px;">
                        <div style="font-size: 2em; font-weight: bold; color: #3498db;">48h</div>
                        <div style="font-size: 14px; color: #666;">Intervalo Contactos</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: #f8f9fa; border-radius: 10px;">
                        <div style="font-size: 2em; font-weight: bold; color: #e74c3c;">20</div>
                        <div style="font-size: 14px; color: #666;">Máximo Intentos</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: #f8f9fa; border-radius: 10px;">
                        <div style="font-size: 2em; font-weight: bold; color: #27ae60;">89%</div>
                        <div style="font-size: 14px; color: #666;">Efectividad</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: #f8f9fa; border-radius: 10px;">
                        <div style="font-size: 2em; font-weight: bold; color: #9b59b6;">2</div>
                        <div style="font-size: 14px; color: #666;">Clientes Activos</div>
                    </div>
                </div>
            </div>

            <div style="background: white; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); padding: 25px;">
                <h3>💬 Plantillas de Mensajes Automáticos</h3>
                <div style="margin-top: 20px;">
                    <h4>Fase 1: Recordatorio Inicial</h4>
                    <textarea class="form-control" rows="4">Hola {CLIENTE}, le recordamos que su póliza {POLIZA} de {ASEGURADORA} vence el {VENCIMIENTO}. 

Monto: {MONTO}
{INFO_VEHICULO}

Para mantener su cobertura activa, puede pagar o contactarnos.
Si ya pagó, responda "PAGUÉ" con el comprobante.

Saludos, {CORREDOR}</textarea>
                    
                    <h4 style="margin-top: 20px;">Fase 2: Recordatorio Urgente</h4>
                    <textarea class="form-control" rows="4">URGENTE: {CLIENTE}, su póliza {POLIZA} está VENCIDA.

🚨 Días vencido: {DIAS_VENCIDO}
💰 Monto: {MONTO}
🏢 Aseguradora: {ASEGURADORA}
{INFO_VEHICULO}

Su cobertura puede ser cancelada. Contacte: {TELEFONO}

{CORREDOR}</textarea>
                </div>
            </div>
        </div>

        <!-- Tab Comprobantes -->
        <div id="comprobantes" class="tab-content">
            <h2>📄 Gestión de Comprobantes de Pago</h2>
            
            <div class="alert alert-warning">
                <h4>🔔 Comprobantes Pendientes</h4>
                <p><strong>1 comprobante pendiente</strong> de verificación. Cliente pagó directamente a la aseguradora.</p>
            </div>

            <div style="background: white; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); padding: 25px;">
                <h3>📋 Lista de Comprobantes</h3>
                
                <div style="border: 2px solid #f39c12; border-radius: 10px; padding: 20px; background: #fffbf3; margin-top: 20px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <h4 style="margin: 0; color: #333;">María González Castro</h4>
                            <p style="margin: 5px 0; color: #666;">Póliza: 0104AUT0261819-00 • ₡45,000</p>
                            <p style="margin: 5px 0; font-size: 12px; color: #f39c12;"><strong>Cliente reportó pago hace 2 horas</strong></p>
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button class="upload-btn" onclick="solicitarComprobante()">📱 Solicitar</button>
                            <button class="upload-btn" onclick="subirComprobante()">📎 Subir</button>
                            <button class="upload-btn" onclick="confirmarPago()">✅ Confirmar</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab Comunicación -->
        <div id="comunicacion" class="tab-content">
            <h2>📧 Centro de Comunicación</h2>
            
            <div class="form-group">
                <label>📧 Plantilla Email:</label>
                <textarea class="form-control" rows="8">Estimado/a {CLIENTE},

Le escribo sobre su póliza {POLIZA} por {MONTO}.

Detalles:
• Aseguradora: {ASEGURADORA}
• Tipo: {TIPO_SEGURO}
• Vencimiento: {VENCIMIENTO}
{INFO_VEHICULO}

Si ya pagó, responda con el comprobante.

Cordialmente,
{CORREDOR}</textarea>
            </div>

            <div class="form-group">
                <label>💬 Plantilla WhatsApp:</label>
                <textarea class="form-control" rows="6">Hola {CLIENTE}!

Póliza {POLIZA} vence {VENCIMIENTO}
Monto: {MONTO}
{INFO_VEHICULO}

¿Ya pagó? Responda "PAGUÉ" + comprobante

{CORREDOR}</textarea>
            </div>

            <div>
                <button class="upload-btn" onclick="comunicacionMasiva()">📧 Envío Masivo Email</button>
                <button class="upload-btn" onclick="comunicacionMasiva()" style="background: #25d366;">💬 Envío Masivo WhatsApp</button>
            </div>
        </div>

        <!-- Tab Reportes -->
        <div id="reportes" class="tab-content">
            <h2>📊 Reportes y Análisis</h2>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px;">
                <button class="upload-btn" onclick="generarReporte('cartera')" style="background: #2c3e50; padding: 20px;">
                    <div>📋 Reporte de Cartera</div>
                    <small>Estado actual completo</small>
                </button>
                
                <button class="upload-btn" onclick="generarReporte('seguimiento')" style="background: #9b59b6; padding: 20px;">
                    <div>🤖 Reporte Seguimiento</div>
                    <small>Efectividad del sistema</small>
                </button>
                
                <button class="upload-btn" onclick="generarReporte('comprobantes')" style="background: #f39c12; padding: 20px;">
                    <div>📄 Reporte Comprobantes</div>
                    <small>Estados y tiempos</small>
                </button>
            </div>

            <div id="reporteResultados">
                <div style="text-align: center; padding: 40px; background: #f8f9fa; border-radius: 10px;">
                    <h3 style="color: #666;">📊 Área de Reportes</h3>
                    <p style="color: #666;">Selecciona un tipo de reporte para generar análisis detallados</p>
                </div>
            </div>
        </div>

        <!-- Tab Configuración -->
        <div id="configuracion" class="tab-content">
            <h2>⚙️ Configuración del Sistema</h2>
            
            <div class="form-group">
                <h3>👤 Información del Corredor</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                    <div>
                        <label>Nombre Completo:</label>
                        <input type="text" class="form-control" id="nombreCorrector" placeholder="Su nombre completo">
                    </div>
                    <div>
                        <label>Teléfono:</label>
                        <input type="text" class="form-control" id="telefonoCorrector" placeholder="8888-7777">
                    </div>
                    <div>
                        <label>Email:</label>
                        <input type="email" class="form-control" id="emailCorrector" placeholder="corredor@ejemplo.com">
                    </div>
                </div>
            </div>

            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 15px; padding: 25px; margin: 25px 0;">
                <h3>🤖 Configuración Seguimiento Automático</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 20px;">
                    <div class="form-group">
                        <label style="color: white;">Intervalo entre contactos (horas):</label>
                        <input type="number" class="form-control" value="48" min="1" max="168">
                    </div>
                    <div class="form-group">
                        <label style="color: white;">Máximo intentos por cliente:</label>
                        <input type="number" class="form-control" value="20" min="1" max="50">
                    </div>
                    <div class="form-group">
                        <label style="color: white;">Sensibilidad IA (1-10):</label>
                        <input type="range" class="form-control" min="1" max="10" value="7">
                    </div>
                </div>
            </div>

            <div>
                <button class="upload-btn" onclick="guardarConfiguracion()">💾 Guardar Configuración</button>
                <button class="upload-btn" onclick="exportarConfiguracion()" style="background: #9b59b6;">📤 Exportar</button>
                <button class="upload-btn" onclick="limpiarDatos()" style="background: #e74c3c;">🗑️ Limpiar Datos</button>
            </div>
        </div>
    </div>

    <!-- Panel de Notificaciones -->
    <div id="notificationPanel" class="notification-panel"></div>

    <script>
        // Variables globales simples
        var datosCartera = [];
        var sistemaActivo = true;

        // Función principal para cambiar pestañas
        function cambiarTab(tabName) {
            // Ocultar todas las pestañas
            var tabs = document.querySelectorAll('.tab-content');
            tabs.forEach(function(tab) {
                tab.classList.remove('active');
            });
            
            // Remover clase active de todos los botones
            var buttons = document.querySelectorAll('.nav-tab');
            buttons.forEach(function(button) {
                button.classList.remove('active');
            });
            
            // Mostrar pestaña seleccionada
            var targetTab = document.getElementById(tabName);
            if (targetTab) {
                targetTab.classList.add('active');
            }
            
            // Activar botón correspondiente
            var activeButton = document.querySelector('[onclick="cambiarTab(\'' + tabName + '\')"]');
            if (activeButton) {
                activeButton.classList.add('active');
            }
            
            console.log('Pestaña cambiada a:', tabName);
        }

        // Función para mostrar notificaciones
        function mostrarNotificacion(mensaje, tipo) {
            tipo = tipo || 'info';
            
            var panel = document.getElementById('notificationPanel');
            if (!panel) return;
            
            var iconos = {
                'success': '✅',
                'error': '❌', 
                'warning': '⚠️',
                'info': 'ℹ️',
                'payment': '💰',
                'alert': '🔔'
            };
            
            var notification = document.createElement('div');
            notification.className = 'notification ' + tipo;
            notification.innerHTML = 
                '<div style="display: flex; align-items: center; gap: 10px;">' +
                    '<span style="font-size: 18px;">' + (iconos[tipo] || 'ℹ️') + '</span>' +
                    '<div style="flex: 1;">' +
                        '<div style="font-weight: bold; margin-bottom: 5px;">' + mensaje + '</div>' +
                        '<div style="font-size: 12px; opacity: 0.8;">' + new Date().toLocaleTimeString() + '</div>' +
                    '</div>' +
                    '<button onclick="this.parentElement.parentElement.remove()" style="background: none; border: none; font-size: 18px; cursor: pointer; opacity: 0.6;">×</button>' +
                '</div>';
            
            panel.appendChild(notification);
            
            // Auto eliminar después de 5 segundos
            setTimeout(function() {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 5000);
        }

        // Funciones del sistema
        function cargarExcel(input) {
            var file = input.files[0];
            if (!file) return;

            if (!file.name.match(/\.(xlsx|xls)$/i)) {
                mostrarNotificacion('Error: Solo archivos Excel (.xlsx, .xls)', 'error');
                return;
            }

            mostrarNotificacion('Procesando archivo: ' + file.name, 'info');
            
            var reader = new FileReader();
            reader.onload = function(e) {
                try {
                    var data = new Uint8Array(e.target.result);
                    var workbook = XLSX.read(data, {type: 'array'});
                    var firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                    var jsonData = XLSX.utils.sheet_to_json(firstSheet, {header: 1});
                    
                    procesarDatos(jsonData);
                    
                } catch (error) {
                    mostrarNotificacion('Error procesando archivo: ' + error.message, 'error');
                }
            };
            
            reader.readAsArrayBuffer(file);
        }

        function procesarDatos(data) {
            if (!data || data.length < 2) {
                mostrarNotificacion('Archivo vacío o sin datos válidos', 'error');
                return;
            }

            var rows = data.slice(1);
            datosCartera = rows.map(function(row, index) {
                return {
                    id: index + 1,
                    cliente: row[0] || 'Cliente ' + (index + 1),
                    poliza: row[1] || '',
                    aseguradora: row[2] || '',
                    monto: parseFloat(row[3]) || 0,
                    moneda: row[4] || 'CRC'
                };
            });

            document.getElementById('recordCount').textContent = datosCartera.length;
            document.getElementById('fileInfo').style.display = 'block';
            document.getElementById('processBtn').disabled = false;
            document.getElementById('processBtn').style.opacity = '1';
            
            mostrarNotificacion('Archivo procesado: ' + datosCartera.length + ' registros', 'success');
        }

        function activarSistema() {
            mostrarNotificacion('Sistema de seguimiento automático ACTIVADO', 'success');
            cambiarTab('cartera');
        }

        function enviarEmail(clienteId) {
            mostrarNotificacion('Email preparado para cliente ' + clienteId, 'success');
        }

        function enviarWhatsApp(clienteId) {
            var mensaje = 'Hola, le recordamos sobre su póliza de seguro. Saludos.';
            var telefono = '50688887777';
            var url = 'https://wa.me/' + telefono + '?text=' + encodeURIComponent(mensaje);
            window.open(url, '_blank');
            mostrarNotificacion('WhatsApp abierto para cliente ' + clienteId, 'success');
        }

        function marcarPagado(clienteId) {
            mostrarNotificacion('Cliente ' + clienteId + ' marcado como pagado', 'success');
        }

        function comunicacionMasiva() {
            if (confirm('¿Enviar mensajes a todos los clientes pendientes?')) {
                mostrarNotificacion('Comunicación masiva iniciada', 'info');
                
                setTimeout(function() {
                    mostrarNotificacion('Enviado a María González', 'info');
                }, 2000);
                
                setTimeout(function() {
                    mostrarNotificacion('Enviado a Carlos Ramírez', 'info');
                }, 4000);
                
                setTimeout(function() {
                    mostrarNotificacion('Comunicación masiva completada', 'success');
                }, 6000);
            }
        }

        function exportarDatos() {
            mostrarNotificacion('Exportando datos a Excel...', 'info');
            setTimeout(function() {
                mostrarNotificacion('Datos exportados exitosamente', 'success');
            }, 2000);
        }

        function descargarPlantilla(tipo) {
            var datos = [];
            
            if (tipo === 'vacia') {
                datos = [
                    ['Asegurado', '# Póliza', 'Aseguradora', 'Monto', 'Moneda', 'Vencimiento', 'Teléfono', 'Email', 'Forma de Pago', 'Placa', 'Marca'],
                    ['', '', '', '', 'CRC', '', '', '', '', '', ''],
                    ['', '', '', '', 'USD', '', '', '', '', '', '']
                ];
            } else if (tipo === 'ejemplo') {
                datos = [
                    ['Asegurado', '# Póliza', 'Aseguradora', 'Monto', 'Moneda', 'Vencimiento', 'Teléfono', 'Email', 'Forma de Pago', 'Placa', 'Marca'],
                    ['MARÍA GONZÁLEZ', '0104AUT0261819-00', 'INS', 45000, 'CRC', '2024-12-15', '88887777', 'maria@email.com', 'Mensual', 'ABC123', 'Toyota'],
                    ['CARLOS RAMÍREZ', '0104RCG0000138-08', 'INS', 1250, 'USD', '2024-12-08', '87776666', 'carlos@email.com', 'Trimestral', '', '']
                ];
            } else if (tipo === 'ins') {
                datos = [
                    ['Asegurado', '# Póliza', 'Aseguradora', 'Monto', 'Moneda', 'Vencimiento', 'Teléfono', 'Email', 'Forma de Pago', 'Placa', 'Marca'],
                    ['CLIENTE 1', '0104AUT0000001-00', 'INS', 50000, 'CRC', '2024-12-31', '88887777', 'cliente1@email.com', 'Mensual', 'ABC123', 'Toyota'],
                    ['CLIENTE 2', '0104RCG0000002-00', 'INS', 120000, 'CRC', '2025-01-15', '87776666', 'cliente2@email.com', 'Trimestral', '', '']
                ];
            }
            
            try {
                var wb = XLSX.utils.book_new();
                var ws = XLSX.utils.aoa_to_sheet(datos);
                XLSX.utils.book_append_sheet(wb, ws, 'Cartera');
                XLSX.writeFile(wb, 'Plantilla_V5_' + tipo + '.xlsx');
                mostrarNotificacion('Plantilla ' + tipo + ' descargada', 'success');
            } catch (error) {
                mostrarNotificacion('Error descargando plantilla: ' + error.message, 'error');
            }
        }

        function generarReporte(tipo) {
            var html = '';
            
            if (tipo === 'cartera') {
                html = '<div style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">' +
                       '<h3>📋 Reporte de Cartera</h3>' +
                       '<p><strong>Total clientes:</strong> 4</p>' +
                       '<p><strong>Monto total:</strong> ₡1,365,000 + $2,000 USD</p>' +
                       '<p><strong>Clientes vencidos:</strong> 1</p>' +
                       '<p><strong>En seguimiento automático:</strong> 2</p>' +
                       '</div>';
            } else if (tipo === 'seguimiento') {
                html = '<div style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">' +
                       '<h3>🤖 Reporte de Seguimiento Automático</h3>' +
                       '<p><strong>Clientes en seguimiento:</strong> 2</p>' +
                       '<p><strong>Total intentos realizados:</strong> 23</p>' +
                       '<p><strong>Tasa de respuesta:</strong> 89%</p>' +
                       '<p><strong>Efectividad del sistema:</strong> Excelente</p>' +
                       '</div>';
            } else if (tipo === 'comprobantes') {
                html = '<div style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">' +
                       '<h3>📄 Reporte de Comprobantes</h3>' +
                       '<p><strong>Comprobantes pendientes:</strong> 1</p>' +
                       '<p><strong>Comprobantes verificados:</strong> 1</p>' +
                       '<p><strong>Tiempo promedio proceso:</strong> 1.8 horas</p>' +
                       '</div>';
            }
            
            document.getElementById('reporteResultados').innerHTML = html;
            mostrarNotificacion('Reporte ' + tipo + ' generado', 'success');
        }

        function solicitarComprobante() {
            mostrarNotificacion('Solicitud de comprobante enviada', 'info');
        }

        function subirComprobante() {
            var input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*,.pdf';
            input.click();
            mostrarNotificacion('Seleccione el archivo del comprobante', 'info');
        }

        function confirmarPago() {
            if (confirm('¿Confirmar que el pago fue recibido?')) {
                mostrarNotificacion('Pago confirmado y reportado a la aseguradora', 'success');
            }
        }

        function guardarConfiguracion() {
            mostrarNotificacion('Configuración guardada exitosamente', 'success');
        }

        function exportarConfiguracion() {
            mostrarNotificacion('Configuración exportada', 'success');
        }

        function limpiarDatos() {
            if (confirm('¿Está seguro de eliminar todos los datos?')) {
                datosCartera = [];
                mostrarNotificacion('Datos eliminados correctamente', 'success');
            }
        }

        // Inicialización del sistema
        function inicializar() {
            console.log('✅ Sistema de Cobros V5 iniciado correctamente');
            
            // Mostrar notificación de bienvenida
            setTimeout(function() {
                mostrarNotificacion('🚀 Sistema V5 iniciado - Seguimiento automático disponible', 'success');
            }, 1000);
            
            // Simular alertas de ejemplo
            setTimeout(function() {
                mostrarNotificacion('💰 María González reportó pago - Verificar comprobante', 'payment');
            }, 3000);
            
            setTimeout(function() {
                mostrarNotificacion('🔔 Carlos Ramírez - 15 intentos sin respuesta', 'alert');
            }, 8000);
        }

        // Ejecutar cuando esté listo
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', inicializar);
        } else {
            inicializar();
        }

        console.log('✅ Sistema de Cobros V5 - Cargado exitosamente');
    </script>
</body>
</html>
