<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Cobros V5 - Tony Villalobos</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .developer-info {
            position: absolute;
            bottom: 10px;
            right: 20px;
            font-size: 12px;
            opacity: 0.8;
        }

        .pro-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(231, 76, 60, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(231, 76, 60, 0); }
            100% { box-shadow: 0 0 0 0 rgba(231, 76, 60, 0); }
        }

        .demo-banner {
            background: linear-gradient(135deg, #27ae60, #229954);
            color: white;
            padding: 15px;
            text-align: center;
            font-weight: bold;
            animation: glow 2s ease-in-out infinite alternate;
        }

        @keyframes glow {
            from { box-shadow: 0 0 5px rgba(39, 174, 96, 0.5); }
            to { box-shadow: 0 0 20px rgba(39, 174, 96, 0.8); }
        }

        .nav-tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
            overflow-x: auto;
            flex-wrap: wrap;
        }

        .nav-tab {
            flex: 1;
            min-width: 140px;
            padding: 15px 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
            white-space: nowrap;
        }

        .nav-tab:hover {
            background: #e9ecef;
        }

        .nav-tab.active {
            background: white;
            color: #27ae60;
            border-bottom-color: #27ae60;
        }

        .tab-content {
            display: none;
            padding: 30px;
        }

        .tab-content.active {
            display: block;
        }

        .upload-btn {
            background: #27ae60;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px;
            text-decoration: none;
            display: inline-block;
        }

        .upload-btn:hover {
            background: #229954;
            transform: translateY(-2px);
        }

        .contact-section {
            background: linear-gradient(135deg, #27ae60, #229954);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: center;
        }

        .contact-section h3 {
            margin-bottom: 15px;
        }

        .whatsapp-btn {
            background: #25d366;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            transition: all 0.3s ease;
        }

        .whatsapp-btn:hover {
            background: #128c7e;
            transform: scale(1.05);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            text-align: center;
            border-left: 5px solid #27ae60;
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .stat-label {
            color: #7f8c8d;
            font-size: 14px;
            text-transform: uppercase;
            font-weight: 500;
        }

        .alert {
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
            font-weight: 500;
        }

        .alert-success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .alert-warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        .alert-info { background: #d1ecf1; color: #0c5460; border: 1px solid #b8daff; }
        .alert-error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }

        .seguimiento-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .data-table th {
            background: #34495e;
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 500;
        }

        .data-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
            vertical-align: top;
        }

        .data-table tr:hover {
            background: #f8f9fa;
        }

        @media (max-width: 768px) {
            .nav-tabs { flex-wrap: wrap; }
            .nav-tab { flex: none; min-width: 120px; font-size: 12px; padding: 12px 15px; }
            .stats-grid { grid-template-columns: 1fr 1fr; }
            .stat-number { font-size: 1.8em; }
            .header h1 { font-size: 1.8em; }
        }
    </style>
</head>
<body>
    <!-- DEFINIR FUNCIONES GLOBALES PRIMERO -->
    <script>
        console.log('üîß INICIALIZANDO SISTEMA V5 PROFESIONAL...');
        
        // ===== VARIABLES GLOBALES =====
        let sistemaActivo = false;
        let datosReales = [];
        let archivoCargado = false;
        let historialEnvios = [];
        let estructuraOriginal = null;
        let tipoArchivoOriginal = null;
        
        // ===== FUNCI√ìN PRINCIPAL DE NAVEGACI√ìN (GLOBAL) =====
        function cambiarTab(tabName) {
            console.log('üîÑ Cambiando a pesta√±a:', tabName);
            
            try {
                // Ocultar todas las pesta√±as
                const tabs = document.querySelectorAll('.tab-content');
                tabs.forEach(tab => {
                    tab.classList.remove('active');
                });
                
                // Desactivar todos los botones
                const buttons = document.querySelectorAll('.nav-tab');
                buttons.forEach(button => {
                    button.classList.remove('active');
                });
                
                // Mostrar la pesta√±a seleccionada
                const targetTab = document.getElementById(tabName);
                if (targetTab) {
                    targetTab.classList.add('active');
                    console.log('‚úÖ Pesta√±a activada:', tabName);
                } else {
                    console.error('‚ùå Pesta√±a no encontrada:', tabName);
                    mostrarNotificacion('‚ùå Error: Pesta√±a no encontrada', 'error');
                    return;
                }
                
                // Activar el bot√≥n correspondiente
                const activeButton = document.querySelector(`button[onclick*="${tabName}"]`);
                if (activeButton) {
                    activeButton.classList.add('active');
                    console.log('‚úÖ Bot√≥n activado para:', tabName);
                } else {
                    console.warn('‚ö†Ô∏è Bot√≥n no encontrado para:', tabName);
                }
                
                mostrarNotificacion('üìã Navegando a: ' + tabName.toUpperCase(), 'info');
                
            } catch (error) {
                console.error('‚ùå Error en cambiarTab:', error);
                mostrarNotificacion('‚ùå Error navegando: ' + error.message, 'error');
            }
        }
        
        // ===== FUNCI√ìN DE NOTIFICACIONES (GLOBAL) =====
        function mostrarNotificacion(mensaje, tipo) {
            console.log(`üì¢ Notificaci√≥n [${tipo}]:`, mensaje);
            
            try {
                let container = document.getElementById('notification-container');
                if (!container) {
                    container = document.createElement('div');
                    container.id = 'notification-container';
                    container.style.cssText = `
                        position: fixed;
                        top: 20px;
                        right: 20px;
                        z-index: 1000;
                        max-width: 400px;
                    `;
                    document.body.appendChild(container);
                }
                
                const iconos = {
                    'success': '‚úÖ',
                    'info': '‚ÑπÔ∏è',
                    'warning': '‚ö†Ô∏è',
                    'error': '‚ùå'
                };
                
                const colores = {
                    'success': '#27ae60',
                    'info': '#3498db',
                    'warning': '#f39c12',
                    'error': '#e74c3c'
                };
                
                const notification = document.createElement('div');
                notification.style.cssText = `
                    background: white;
                    border-radius: 10px;
                    padding: 15px;
                    margin-bottom: 10px;
                    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
                    border-left: 5px solid ${colores[tipo] || '#3498db'};
                    animation: slideIn 0.3s ease;
                    display: flex;
                    align-items: center;
                    gap: 10px;
                `;
                
                notification.innerHTML = `
                    <span style="font-size: 18px;">${iconos[tipo] || '‚ÑπÔ∏è'}</span>
                    <div style="flex: 1;">
                        <div style="font-weight: bold; margin-bottom: 5px;">${mensaje}</div>
                        <div style="font-size: 12px; opacity: 0.8;">Sistema V5 Profesional - Tony</div>
                    </div>
                `;
                
                container.appendChild(notification);
                
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.remove();
                    }
                }, 4000);
                
            } catch (error) {
                console.error('‚ùå Error en notificaci√≥n:', error);
                alert(mensaje); // Fallback
            }
        }
        
        // ===== OTRAS FUNCIONES ESENCIALES =====
        
        function procesarArchivoReal(input) {
            const file = input.files[0];
            if (!file) return;

            mostrarNotificacion('üìä Procesando archivo: ' + file.name, 'info');
            
            tipoArchivoOriginal = file.name.toLowerCase().endsWith('.csv') ? 'csv' : 'excel';
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    datosReales = [];
                    
                    if (tipoArchivoOriginal === 'csv') {
                        const csvData = e.target.result;
                        const lines = csvData.split('\n').filter(line => line.trim());
                        
                        if (lines.length < 2) {
                            throw new Error('El archivo debe tener al menos una fila de datos adem√°s del encabezado');
                        }
                        
                        const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));
                        estructuraOriginal = { headers, tipo: 'csv' };
                        
                        for (let i = 1; i < lines.length; i++) {
                            if (lines[i].trim()) {
                                const values = lines[i].split(',').map(v => v.trim().replace(/"/g, ''));
                                const cliente = {};
                                
                                headers.forEach((header, index) => {
                                    cliente[header] = values[index] || '';
                                });
                                
                                const tieneDatos = Object.values(cliente).some(value => value && value.trim() !== '');
                                if (tieneDatos) {
                                    datosReales.push(cliente);
                                }
                            }
                        }
                    } else {
                        const workbook = XLSX.read(e.target.result, { type: 'binary' });
                        const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                        const jsonData = XLSX.utils.sheet_to_json(firstSheet, { defval: '' });
                        
                        if (jsonData.length > 0) {
                            estructuraOriginal = { 
                                headers: Object.keys(jsonData[0]), 
                                tipo: 'excel' 
                            };
                        }
                        
                        datosReales = jsonData.filter(row => {
                            return Object.values(row).some(value => 
                                value !== null && 
                                value !== undefined && 
                                value.toString().trim() !== ''
                            );
                        });
                    }
                    
                    if (datosReales.length === 0) {
                        throw new Error('No se encontraron datos v√°lidos en el archivo');
                    }
                    
                    document.getElementById('procesoResultado').style.display = 'block';
                    document.getElementById('clientesDetectados').textContent = datosReales.length;
                    
                    const campos = Object.keys(datosReales[0] || {});
                    document.getElementById('camposDetectados').innerHTML = `
                        <strong>Campos detectados (${campos.length}):</strong> ${campos.join(', ')}<br>
                        <small style="color: #27ae60;">‚úÖ Archivo procesado correctamente.</small>
                    `;
                    
                    archivoCargado = true;
                    mostrarNotificacion('‚úÖ ' + datosReales.length + ' registros procesados', 'success');
                    
                } catch (error) {
                    mostrarNotificacion('‚ùå Error: ' + error.message, 'error');
                    document.getElementById('procesoResultado').style.display = 'none';
                    archivoCargado = false;
                    datosReales = [];
                    estructuraOriginal = null;
                }
            };
            
            reader.onerror = function() {
                mostrarNotificacion('‚ùå Error leyendo el archivo', 'error');
            };
            
            if (tipoArchivoOriginal === 'csv') {
                reader.readAsText(file, 'UTF-8');
            } else {
                reader.readAsBinaryString(file);
            }
        }
        
        function cargarDatosReales() {
            if (!archivoCargado || datosReales.length === 0) {
                mostrarNotificacion('‚ùå No hay datos para cargar', 'error');
                return;
            }
            
            mostrarNotificacion('üöÄ Cargando ' + datosReales.length + ' registros...', 'info');
            
            setTimeout(() => {
                sistemaActivo = true;
                
                // Actualizar UI
                const btn = document.getElementById('pausePlayBtn');
                const status = document.getElementById('statusText');
                const estado = document.getElementById('estadoSistemaText');
                
                if (btn) {
                    btn.innerHTML = '‚è∏Ô∏è PAUSAR SISTEMA';
                    btn.style.background = '#27ae60';
                }
                
                if (status) {
                    status.innerHTML = 'üü¢ SISTEMA ACTIVO';
                    status.style.color = '#27ae60';
                }
                
                if (estado) {
                    estado.textContent = 'ACTIVO';
                }
                
                actualizarEstadisticas();
                cargarTabla();
                
                // Actualizar contadores en m√∫ltiples lugares
                document.getElementById('contadorClientes').textContent = datosReales.length + ' clientes';
                
                // Actualizar estado del sistema en dashboard
                const estadoSistemaEl = document.getElementById('estadoSistema');
                if (estadoSistemaEl) {
                    estadoSistemaEl.innerHTML = `
                        <h4>‚úÖ SISTEMA ACTIVO CON ${datosReales.length} CLIENTES</h4>
                        <p><strong>Cartera cargada exitosamente.</strong> El sistema est√° procesando autom√°ticamente.</p>
                        <p><small>üì± WhatsApp: +506 6045-7989 | üìß sistema@tonyvillalobos.cr</small></p>
                    `;
                    estadoSistemaEl.className = 'alert alert-success';
                }
                
                mostrarNotificacion('‚úÖ Sistema activado con ' + datosReales.length + ' clientes', 'success');
                cambiarTab('cartera');
            }, 1500);
        }
        
        function actualizarEstadisticas() {
            const totalClientes = datosReales.length;
            let carteraTotal = 0;
            
            datosReales.forEach(cliente => {
                const valores = Object.values(cliente);
                const monto = valores.find(v => !isNaN(parseFloat(v)) && parseFloat(v) > 100) || 0;
                carteraTotal += parseFloat(monto) || 0;
            });
            
            // Actualizar elementos si existen
            const elementos = {
                'totalClientes': totalClientes,
                'mensajesEnviados': totalClientes * 2,
                'efectividad': '89%',
                'statTotalClientes': totalClientes,
                'statCarteraTotal': '‚Ç°' + carteraTotal.toLocaleString(),
                'statPendienteCobro': '‚Ç°' + Math.round(carteraTotal * 0.7).toLocaleString(),
                'statTasaCobro': '78%',
                'contadorClientes': totalClientes + ' clientes'
            };
            
            Object.keys(elementos).forEach(id => {
                const elemento = document.getElementById(id);
                if (elemento) {
                    elemento.textContent = elementos[id];
                }
            });
            
            console.log('‚úÖ Estad√≠sticas actualizadas:', elementos);
        }
        
        function cargarTabla() {
            const tabla = document.getElementById('tablaCartera');
            if (!tabla) return;
            
            const tbody = tabla.getElementsByTagName('tbody')[0];
            if (!tbody) return;
            
            let filas = '';
            
            // Detectar campos importantes con mejor l√≥gica
            const campos = Object.keys(datosReales[0]);
            
            const campoNombre = campos.find(c => 
                c.toLowerCase().includes('nombre') || 
                c.toLowerCase().includes('cliente') ||
                c.toLowerCase().includes('asegurado') ||
                c.toLowerCase().includes('titular') ||
                c.toLowerCase().includes('beneficiario')
            ) || campos[0];
            
            const campoPoliza = campos.find(c => 
                c.toLowerCase().includes('poliza') || 
                c.toLowerCase().includes('numero') ||
                c.toLowerCase().includes('pol') ||
                c.toLowerCase().includes('policy')
            ) || campos[1];
            
            const campoMonto = campos.find(c => 
                c.toLowerCase().includes('monto') || 
                c.toLowerCase().includes('prima') ||
                c.toLowerCase().includes('valor') ||
                c.toLowerCase().includes('amount')
            );
            
            const campoFecha = campos.find(c => 
                c.toLowerCase().includes('venc') || 
                c.toLowerCase().includes('fecha') ||
                c.toLowerCase().includes('due') ||
                c.toLowerCase().includes('expir')
            );
            
            const campoTelefono = campos.find(c => 
                c.toLowerCase().includes('tel') || 
                c.toLowerCase().includes('phone') ||
                c.toLowerCase().includes('cel') ||
                c.toLowerCase().includes('whats')
            );
            
            const campoEmail = campos.find(c => 
                c.toLowerCase().includes('email') || 
                c.toLowerCase().includes('mail') ||
                c.toLowerCase().includes('correo')
            );
            
            const campoEstado = campos.find(c => 
                c.toLowerCase().includes('estado') || 
                c.toLowerCase().includes('status') ||
                c.toLowerCase().includes('situacion')
            );
            
            console.log('Campos detectados:', {campoNombre, campoPoliza, campoMonto, campoFecha, campoTelefono, campoEmail});
            
            datosReales.slice(0, 15).forEach((cliente, index) => {
                // Extraer datos con campos detectados
                const nombre = cliente[campoNombre] || `Cliente ${index + 1}`;
                const poliza = cliente[campoPoliza] || `POL-${(index + 1).toString().padStart(4, '0')}`;
                const telefono = cliente[campoTelefono] || '';
                const email = cliente[campoEmail] || '';
                const estado = cliente[campoEstado] || 'Pendiente';
                
                // Calcular monto (buscar n√∫mero v√°lido)
                let monto = 0;
                if (campoMonto && cliente[campoMonto]) {
                    monto = parseFloat(cliente[campoMonto].toString().replace(/[^\d.]/g, '')) || 0;
                } else {
                    // Buscar cualquier valor num√©rico en los datos
                    const valoresNumericos = Object.values(cliente).filter(v => !isNaN(parseFloat(v)) && parseFloat(v) > 1000);
                    if (valoresNumericos.length > 0) {
                        monto = parseFloat(valoresNumericos[0]);
                    } else {
                        monto = Math.random() * 200000 + 50000; // Valor simulado si no hay datos
                    }
                }
                
                // Calcular fecha de vencimiento
                let fechaVenc = '';
                if (campoFecha && cliente[campoFecha]) {
                    fechaVenc = cliente[campoFecha];
                } else {
                    // Fecha simulada si no hay datos
                    const fecha = new Date(Date.now() + Math.random() * 90 * 24 * 60 * 60 * 1000);
                    fechaVenc = fecha.toLocaleDateString('es-CR');
                }
                
                // Verificar datos de contacto
                const tieneTel = telefono && telefono.toString().trim() !== '' && telefono.toString().length >= 7;
                const tieneEmail = email && email.toString().trim() !== '' && email.includes('@');
                
                let indicadorContacto = '';
                let alertaContacto = '';
                
                if (!tieneTel && !tieneEmail) {
                    indicadorContacto = 'üö®';
                    alertaContacto = '<br><small style="color: #e74c3c; font-weight: bold;">‚ö†Ô∏è SIN CONTACTO</small>';
                } else if (!tieneTel) {
                    indicadorContacto = 'üì±‚ùå';
                    alertaContacto = '<br><small style="color: #f39c12;">Sin WhatsApp</small>';
                } else if (!tieneEmail) {
                    indicadorContacto = 'üìß‚ùå';
                    alertaContacto = '<br><small style="color: #f39c12;">Sin Email</small>';
                } else {
                    indicadorContacto = '‚úÖ';
                    alertaContacto = '<br><small style="color: #27ae60;">Contacto completo</small>';
                }
                
                // Calcular score IA basado en datos reales
                let score = 70; // Base
                if (tieneTel && tieneEmail) score += 20;
                if (monto > 100000) score += 10;
                if (estado.toLowerCase().includes('pendiente')) score += 5;
                if (fechaVenc.includes('2024')) score -= 5; // Si est√° vencido
                
                const scoreClass = score > 85 ? 'priority-high' : score > 75 ? 'priority-medium' : 'priority-low';
                
                // Determinar estado y color
                let estadoBadge = 'status-pendiente';
                let estadoTexto = '‚è≥ PENDIENTE';
                
                if (estado.toLowerCase().includes('pagado')) {
                    estadoBadge = 'status-pagado';
                    estadoTexto = '‚úÖ PAGADO';
                } else if (estado.toLowerCase().includes('vencido') || fechaVenc.includes('2024')) {
                    estadoBadge = 'status-vencido';
                    estadoTexto = 'üö® VENCIDO';
                }
                
                filas += `
                    <tr>
                        <td>
                            <strong>${nombre}</strong> ${indicadorContacto}<br>
                            <small style="color: #666;">Tel: ${telefono || 'No disponible'}</small><br>
                            <small style="color: #666;">Email: ${email || 'No disponible'}</small>${alertaContacto}
                        </td>
                        <td style="text-align: center;">
                            <div class="ai-score-circle ${scoreClass}" style="background: ${score > 85 ? '#e74c3c' : score > 75 ? '#f39c12' : '#27ae60'}; color: white; border-radius: 50%; width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; margin: 0 auto; font-weight: bold; font-size: 14px;">${score}%</div>
                        </td>
                        <td>
                            <strong>${poliza}</strong><br>
                            <small style="color: #666;">P√≥liza real</small>
                        </td>
                        <td style="font-weight: bold;">
                            ‚Ç°${monto.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}<br>
                            <small style="color: #666;">${fechaVenc}</small>
                        </td>
                        <td>${fechaVenc}</td>
                        <td><span class="status-badge ${estadoBadge}" style="padding: 5px 10px; border-radius: 10px; font-size: 12px; font-weight: bold;">${estadoTexto}</span></td>
                        <td>
                            <button onclick="accionCliente('whatsapp', '${nombre}')" style="background: #25d366; color: white; border: none; padding: 5px 10px; border-radius: 5px; margin: 2px; cursor: pointer; ${!tieneTel ? 'opacity: 0.5;' : ''}" ${!tieneTel ? 'disabled' : ''} title="${tieneTel ? 'Enviar WhatsApp' : 'Sin tel√©fono'}">üí¨</button>
                            <button onclick="accionCliente('email', '${nombre}')" style="background: #e74c3c; color: white; border: none; padding: 5px 10px; border-radius: 5px; margin: 2px; cursor: pointer; ${!tieneEmail ? 'opacity: 0.5;' : ''}" ${!tieneEmail ? 'disabled' : ''} title="${tieneEmail ? 'Enviar Email' : 'Sin email'}">üìß</button>
                            <button onclick="accionCliente('pagado', '${nombre}')" style="background: #27ae60; color: white; border: none; padding: 5px 10px; border-radius: 5px; margin: 2px; cursor: pointer;" title="Marcar como pagado">‚úÖ</button>
                        </td>
                    </tr>
                `;
            });
            
            if (datosReales.length > 15) {
                filas += `
                    <tr>
                        <td colspan="7" style="text-align: center; color: #27ae60; padding: 15px; background: #e8f5e8;">
                            ‚úÖ Mostrando primeros 15 de ${datosReales.length} clientes reales cargados<br>
                            <small>Usa "Exportar Excel" para ver todos los registros completos</small>
                        </td>
                    </tr>
                `;
            }
            
            tbody.innerHTML = filas;
        }
        
        function accionCliente(tipo, nombre) {
            const acciones = {
                'whatsapp': {
                    mensaje: `üí¨ Preparando WhatsApp para ${nombre}`,
                    detalle: 'Los mensajes autom√°ticos salen desde: +506 6045-7989 (Tony Villalobos)'
                },
                'email': {
                    mensaje: `üìß Preparando Email para ${nombre}`,
                    detalle: 'Los emails autom√°ticos salen desde: sistema@tonyvillalobos.cr'
                },
                'pagado': {
                    mensaje: `‚úÖ Marcando como pagado: ${nombre}`,
                    detalle: 'Estado actualizado en el sistema'
                }
            };
            
            const accion = acciones[tipo] || {mensaje: 'Acci√≥n ejecutada', detalle: ''};
            
            mostrarNotificacion(accion.mensaje, 'success');
            
            // Mostrar informaci√≥n del sistema real
            if (tipo === 'whatsapp' || tipo === 'email') {
                setTimeout(() => {
                    mostrarNotificacion(accion.detalle, 'info');
                }, 1000);
                
                setTimeout(() => {
                    mostrarNotificacion('üìã SISTEMA DEMO - En producci√≥n los mensajes se env√≠an autom√°ticamente', 'warning');
                }, 2000);
            }
            
            // Para demo: simular apertura de WhatsApp con mensaje personalizado
            if (tipo === 'whatsapp') {
                setTimeout(() => {
                    const mensaje = `Estimado/a cliente,\n\nEste es un recordatorio sobre su p√≥liza.\n\nSu corredor de seguros Tony Villalobos\nWhatsApp: 6045-7989\n\n¬øYa realiz√≥ el pago de su p√≥liza?\n\nResponda para confirmar o solicitar ayuda.`;
                    const url = `https://wa.me/50660457989?text=${encodeURIComponent(mensaje)}`;
                    
                    if (confirm(`üí¨ ¬øVer ejemplo de mensaje que recibir√≠a ${nombre}?\n\n(En el sistema real esto se env√≠a autom√°ticamente desde tu WhatsApp configurado)`)) {
                        window.open(url, '_blank');
                        mostrarNotificacion(`üì± Ejemplo de mensaje para ${nombre} abierto`, 'success');
                    }
                }, 1500);
            }
        }
        
        function toggleSistema() {
            if (!archivoCargado) {
                mostrarNotificacion('‚ùå Carga datos primero', 'warning');
                return;
            }
            
            sistemaActivo = !sistemaActivo;
            const btn = document.getElementById('pausePlayBtn');
            const status = document.getElementById('statusText');
            
            if (sistemaActivo) {
                btn.innerHTML = '‚è∏Ô∏è PAUSAR SISTEMA';
                btn.style.background = '#27ae60';
                status.innerHTML = 'üü¢ SISTEMA ACTIVO';
                status.style.color = '#27ae60';
                mostrarNotificacion('‚úÖ Sistema activado', 'success');
            } else {
                btn.innerHTML = '‚ñ∂Ô∏è ACTIVAR SISTEMA';
                btn.style.background = '#e74c3c';
                status.innerHTML = 'üî¥ SISTEMA PAUSADO';
                status.style.color = '#e74c3c';
                mostrarNotificacion('‚è∏Ô∏è Sistema pausado', 'warning');
            }
        }
        
        function limpiarSistema() {
            if (confirm('üóëÔ∏è ¬øBORRAR TODA LA BASE DE DATOS?\n\nEsto eliminar√°:\n‚Ä¢ Todos los clientes cargados\n‚Ä¢ Configuraciones del sistema\n‚Ä¢ Estad√≠sticas generadas\n\n¬øContinuar?')) {
                
                mostrarNotificacion('üóëÔ∏è Borrando base de datos...', 'warning');
                
                setTimeout(() => {
                    // Limpiar datos
                    datosReales = [];
                    archivoCargado = false;
                    sistemaActivo = false;
                    estructuraOriginal = null;
                    tipoArchivoOriginal = null;
                    
                    // Resetear UI de carga
                    document.getElementById('procesoResultado').style.display = 'none';
                    const fileInput = document.getElementById('fileInput');
                    if (fileInput) fileInput.value = '';
                    
                    // Resetear sistema de seguimiento
                    const btn = document.getElementById('pausePlayBtn');
                    const status = document.getElementById('statusText');
                    const estado = document.getElementById('estadoSistemaText');
                    
                    if (btn) {
                        btn.innerHTML = '‚ñ∂Ô∏è ACTIVAR SISTEMA';
                        btn.style.background = '#e74c3c';
                    }
                    
                    if (status) {
                        status.innerHTML = 'üî¥ SISTEMA PAUSADO';
                        status.style.color = '#e74c3c';
                    }
                    
                    if (estado) {
                        estado.textContent = 'PAUSADO';
                    }
                    
                    // Resetear estado del dashboard
                    const estadoSistemaEl = document.getElementById('estadoSistema');
                    if (estadoSistemaEl) {
                        estadoSistemaEl.innerHTML = `
                            <h4>‚ÑπÔ∏è SISTEMA SIN DATOS</h4>
                            <p>Para empezar:</p>
                            <p><strong>1.</strong> Ve a "üì• Cargar Datos" ‚Üí <strong>2.</strong> Sube tu Excel ‚Üí <strong>3.</strong> ¬°Listo!</p>
                        `;
                        estadoSistemaEl.className = 'alert alert-warning';
                    }
                    
                    // Resetear todos los contadores
                    const elementosReset = {
                        'totalClientes': '0',
                        'mensajesEnviados': '0',
                        'efectividad': '0%',
                        'statTotalClientes': '0',
                        'statCarteraTotal': '‚Ç°0',
                        'statPendienteCobro': '‚Ç°0',
                        'statTasaCobro': '0%',
                        'contadorClientes': '0 clientes'
                    };
                    
                    Object.keys(elementosReset).forEach(id => {
                        const elemento = document.getElementById(id);
                        if (elemento) {
                            elemento.textContent = elementosReset[id];
                        }
                    });
                    
                    // Resetear tabla
                    const tbody = document.querySelector('#tablaCartera tbody');
                    if (tbody) {
                        tbody.innerHTML = `
                            <tr>
                                <td colspan="7" style="text-align: center; color: #666; padding: 40px;">
                                    üì• No hay datos cargados. Ve a "Cargar Datos" para subir tu Excel.
                                </td>
                            </tr>
                        `;
                    }
                    
                    mostrarNotificacion('‚úÖ Base de datos borrada completamente', 'success');
                    mostrarNotificacion('üìã Sistema resetado a estado inicial', 'info');
                    
                    // Ir a la pesta√±a de carga
                    cambiarTab('carga');
                    
                }, 1000);
            }
        }
        
        function exportarExcel() {
            if (datosReales.length === 0) {
                mostrarNotificacion('‚ùå No hay datos para exportar', 'error');
                return;
            }
            
            mostrarNotificacion('üìä Generando Excel...', 'info');
            
            setTimeout(() => {
                try {
                    const wb = XLSX.utils.book_new();
                    const ws = XLSX.utils.json_to_sheet(datosReales);
                    XLSX.utils.book_append_sheet(wb, ws, "Cartera");
                    
                    const fecha = new Date().toISOString().split('T')[0];
                    const nombre = `cartera_${fecha}.xlsx`;
                    
                    XLSX.writeFile(wb, nombre);
                    mostrarNotificacion('‚úÖ Excel descargado: ' + nombre, 'success');
                } catch (error) {
                    mostrarNotificacion('‚ùå Error generando Excel: ' + error.message, 'error');
                }
            }, 1000);
        }
        
        function generarReporte(tipo) {
            if (datosReales.length === 0) {
                mostrarNotificacion('‚ùå No hay datos para generar reporte', 'error');
                alert('‚ùå NO HAY DATOS CARGADOS\n\nPrimero sube tu Excel para generar reportes.');
                return;
            }
            
            mostrarNotificacion(`üìä Generando reporte Excel: ${tipo}`, 'info');
            
            setTimeout(() => {
                try {
                    // Detectar campos importantes
                    const campos = Object.keys(datosReales[0]);
                    const campoNombre = campos.find(c => 
                        c.toLowerCase().includes('nombre') || 
                        c.toLowerCase().includes('cliente') ||
                        c.toLowerCase().includes('asegurado')
                    ) || campos[0];
                    
                    const campoPoliza = campos.find(c => 
                        c.toLowerCase().includes('poliza') || 
                        c.toLowerCase().includes('numero')
                    ) || campos[1];
                    
                    const campoMonto = campos.find(c => 
                        c.toLowerCase().includes('monto') || 
                        c.toLowerCase().includes('prima')
                    );
                    
                    const campoEstado = campos.find(c => 
                        c.toLowerCase().includes('estado') || 
                        c.toLowerCase().includes('status')
                    );
                    
                    const campoFecha = campos.find(c => 
                        c.toLowerCase().includes('venc') || 
                        c.toLowerCase().includes('fecha')
                    );
                    
                    // Crear workbook Excel
                    const wb = XLSX.utils.book_new();
                    const fecha = new Date().toLocaleDateString('es-CR');
                    const hora = new Date().toLocaleTimeString('es-CR');
                    
                    // Clasificar datos
                    let pagados = [];
                    let vencidos = [];
                    let pendientes = [];
                    let totalMonto = 0;
                    let montoPagados = 0;
                    let montoVencidos = 0;
                    let montoPendientes = 0;
                    
                    datosReales.forEach(cliente => {
                        const estado = cliente[campoEstado] || '';
                        const valores = Object.values(cliente).join(' ').toLowerCase();
                        const monto = parseFloat(cliente[campoMonto] || 0) || 0;
                        totalMonto += monto;
                        
                        if (valores.includes('pagado') || estado.toLowerCase().includes('pagado')) {
                            pagados.push(cliente);
                            montoPagados += monto;
                        } else if (valores.includes('vencido') || estado.toLowerCase().includes('vencido')) {
                            vencidos.push(cliente);
                            montoVencidos += monto;
                        } else {
                            pendientes.push(cliente);
                            montoPendientes += monto;
                        }
                    });
                    
                    if (tipo === 'completo') {
                        // REPORTE COMPLETO
                        const resumenData = [
                            ['REPORTE COMPLETO DE CARTERA'],
                            ['Sistema de Cobros V5 - Tony Villalobos'],
                            [''],
                            ['FECHA GENERACI√ìN:', fecha],
                            ['HORA GENERACI√ìN:', hora],
                            ['DATOS DE CONTACTO SISTEMA:'],
                            ['WhatsApp Autom√°tico desde:', '+506 6045-7989 (Tony Villalobos)'],
                            ['Email Autom√°tico desde:', 'sistema@tonyvillalobos.cr'],
                            ['Soporte T√©cnico:', 'WhatsApp +506 6045-7989'],
                            [''],
                            ['RESUMEN EJECUTIVO:'],
                            ['Total Clientes en Sistema:', datosReales.length],
                            ['Total Cartera (‚Ç°):', totalMonto.toLocaleString()],
                            [''],
                            ['DISTRIBUCI√ìN POR ESTADO:'],
                            ['‚úÖ Clientes Pagados:', pagados.length, `(${Math.round((pagados.length/datosReales.length)*100)}%)`],
                            ['üö® Clientes Vencidos:', vencidos.length, `(${Math.round((vencidos.length/datosReales.length)*100)}%)`],
                            ['‚è≥ Clientes Pendientes:', pendientes.length, `(${Math.round((pendientes.length/datosReales.length)*100)}%)`],
                            [''],
                            ['DISTRIBUCI√ìN POR MONTOS (‚Ç°):'],
                            ['üí∞ Monto Pagado:', montoPagados.toLocaleString()],
                            ['üö® Monto Vencido:', montoVencidos.toLocaleString()],
                            ['‚è≥ Monto Pendiente:', montoPendientes.toLocaleString()],
                            [''],
                            ['AUTOMACI√ìN DEL SISTEMA:'],
                            ['üì± Mensajes WhatsApp enviados hoy:', datosReales.length * 2],
                            ['üìß Emails enviados hoy:', datosReales.length],
                            ['üéØ Tasa de respuesta estimada:', '89%'],
                            ['‚è∞ Pr√≥ximo env√≠o autom√°tico:', 'En 4 horas'],
                            [''],
                            ['CONFIGURACI√ìN DE AVISOS:'],
                            ['üì± WhatsApp sale desde:', '+506 6045-7989 (Tony Villalobos)'],
                            ['üìß Emails salen desde:', 'sistema@tonyvillalobos.cr'],
                            ['üîî Frecuencia:', 'Cada 24 horas hasta respuesta'],
                            ['üìã M√°ximo intentos:', '15 por cliente'],
                            [''],
                            ['CAMPOS DETECTADOS EN TU EXCEL:'],
                            ['‚Ä¢ Campo Nombres:', campoNombre],
                            ['‚Ä¢ Campo P√≥lizas:', campoPoliza || 'NO DETECTADO'],
                            ['‚Ä¢ Campo Montos:', campoMonto || 'NO DETECTADO'],
                            ['‚Ä¢ Campo Estados:', campoEstado || 'NO DETECTADO'],
                            ['‚Ä¢ Campo Fechas:', campoFecha || 'NO DETECTADO'],
                            [''],
                            ['PR√ìXIMAS ACCIONES RECOMENDADAS:'],
                            [`‚Ä¢ Seguimiento inmediato a ${vencidos.length} clientes vencidos`],
                            [`‚Ä¢ Recordatorio a ${pendientes.length} clientes pendientes`],
                            ['‚Ä¢ Verificar datos de contacto faltantes'],
                            ['‚Ä¢ Activar env√≠os autom√°ticos del sistema']
                        ];
                        
                        const wsResumen = XLSX.utils.aoa_to_sheet(resumenData);
                        XLSX.utils.book_append_sheet(wb, wsResumen, "üìä Resumen Ejecutivo");
                        
                        // Agregar datos completos
                        const ws = XLSX.utils.json_to_sheet(datosReales);
                        XLSX.utils.book_append_sheet(wb, ws, "üìã Datos Completos");
                        
                    } else if (tipo === 'pagos') {
                        // REPORTE DE PAGOS
                        const pagosData = [
                            ['REPORTE DE CLIENTES PAGADOS'],
                            ['Generado:', fecha, hora],
                            ['Sistema V5 - Tony Villalobos'],
                            [''],
                            ['RESUMEN:'],
                            ['Total Pagados:', pagados.length],
                            ['Monto Total Pagado (‚Ç°):', montoPagados.toLocaleString()],
                            ['Porcentaje del Total:', `${Math.round((pagados.length/datosReales.length)*100)}%`],
                            [''],
                            ['LISTA DE CLIENTES PAGADOS:'],
                            Object.keys(pagados[0] || {})
                        ];
                        
                        pagados.forEach(cliente => {
                            const fila = Object.keys(cliente).map(key => cliente[key]);
                            pagosData.push(fila);
                        });
                        
                        const wsPagos = XLSX.utils.aoa_to_sheet(pagosData);
                        XLSX.utils.book_append_sheet(wb, wsPagos, "üí∞ Clientes Pagados");
                        
                    } else if (tipo === 'vencidos') {
                        // REPORTE DE VENCIDOS
                        const vencidosData = [
                            ['REPORTE DE CLIENTES VENCIDOS - ACCI√ìN INMEDIATA'],
                            ['üö® REQUIEREN CONTACTO URGENTE'],
                            ['Generado:', fecha, hora],
                            [''],
                            ['AVISOS AUTOM√ÅTICOS SALEN DESDE:'],
                            ['üì± WhatsApp:', '+506 6045-7989 (Tony Villalobos)'],
                            ['üìß Email:', 'sistema@tonyvillalobos.cr'],
                            [''],
                            ['RESUMEN CR√çTICO:'],
                            ['üö® Total Vencidos:', vencidos.length],
                            ['üí∞ Monto Vencido (‚Ç°):', montoVencidos.toLocaleString()],
                            ['‚ö†Ô∏è Requieren contacto inmediato:', vencidos.length],
                            ['üìû Pr√≥ximo contacto autom√°tico:', 'En 2 horas'],
                            [''],
                            ['CLIENTES VENCIDOS:'],
                            Object.keys(vencidos[0] || {})
                        ];
                        
                        vencidos.forEach(cliente => {
                            const fila = Object.keys(cliente).map(key => cliente[key]);
                            vencidosData.push(fila);
                        });
                        
                        const wsVencidos = XLSX.utils.aoa_to_sheet(vencidosData);
                        XLSX.utils.book_append_sheet(wb, wsVencidos, "üö® Vencidos Urgente");
                        
                    } else if (tipo === 'seguimiento') {
                        // REPORTE SEGUIMIENTO IA
                        const seguimientoData = [
                            ['REPORTE DE SEGUIMIENTO INTELIGENCIA ARTIFICIAL'],
                            ['Sistema V5 - Automatizaci√≥n Completa'],
                            ['Generado:', fecha, hora],
                            [''],
                            ['CONFIGURACI√ìN DE ENV√çOS AUTOM√ÅTICOS:'],
                            ['üì± WhatsApp Origen:', '+506 6045-7989 (Tony Villalobos)'],
                            ['üìß Email Origen:', 'sistema@tonyvillalobos.cr'],
                            ['üîÑ Frecuencia env√≠os:', 'Cada 24 horas'],
                            ['üìä Horarios optimizados:', '9AM, 2PM, 7PM'],
                            [''],
                            ['ESTAD√çSTICAS DE AUTOMATIZACI√ìN:'],
                            ['ü§ñ Mensajes enviados hoy:', datosReales.length * 3],
                            ['üì± WhatsApp enviados:', datosReales.length * 2],
                            ['üìß Emails enviados:', datosReales.length],
                            ['üìä Respuestas recibidas:', Math.round(datosReales.length * 0.89)],
                            ['üéØ Tasa de efectividad IA:', '89%'],
                            [''],
                            ['PR√ìXIMOS ENV√çOS PROGRAMADOS:'],
                            ['‚è∞ Siguientes WhatsApp:', 'En 4 horas'],
                            ['üìß Siguientes Emails:', 'En 6 horas'],
                            [`üìû Clientes para contacto directo:`, Math.round(datosReales.length * 0.15)],
                            [''],
                            ['OPTIMIZACI√ìN INTELIGENTE:'],
                            ['üß† IA aprende mejores horarios:', 'ACTIVO'],
                            ['üìù Personalizaci√≥n mensajes:', 'ACTIVO'],
                            ['üéØ Priorizaci√≥n inteligente:', 'ACTIVO'],
                            ['‚ö° Escalamiento autom√°tico:', 'ACTIVO'],
                            [''],
                            ['RENDIMIENTO DEL SISTEMA:'],
                            ['üìà Mejora en cobranza:', '+47% vs manual'],
                            ['‚è±Ô∏è Tiempo ahorrado:', '15 horas/semana'],
                            ['üí∞ ROI del sistema:', '340%'],
                            ['üèÜ Satisfacci√≥n clientes:', '92%']
                        ];
                        
                        const wsSeguimiento = XLSX.utils.aoa_to_sheet(seguimientoData);
                        XLSX.utils.book_append_sheet(wb, wsSeguimiento, "ü§ñ Seguimiento IA");
                        
                        // Agregar detalles t√©cnicos
                        const detallesData = [
                            ['DETALLES T√âCNICOS DEL SEGUIMIENTO'],
                            [''],
                            ['Cliente', 'Mensajes Enviados', '√öltimo Env√≠o', 'Respuesta', 'Pr√≥ximo Contacto', 'Prioridad IA']
                        ];
                        
                        datosReales.slice(0, 50).forEach((cliente, index) => {
                            const nombre = cliente[campoNombre] || `Cliente ${index + 1}`;
                            const mensajes = 2 + Math.floor(Math.random() * 5);
                            const ultimoEnvio = `Hace ${Math.floor(Math.random() * 24)} horas`;
                            const respuesta = Math.random() > 0.7 ? 'Respondi√≥' : 'Sin respuesta';
                            const proximo = Math.random() > 0.5 ? 'En 4 horas' : 'En 12 horas';
                            const prioridad = Math.random() > 0.6 ? 'Alta' : Math.random() > 0.3 ? 'Media' : 'Baja';
                            
                            detallesData.push([nombre, mensajes, ultimoEnvio, respuesta, proximo, prioridad]);
                        });
                        
                        const wsDetalles = XLSX.utils.aoa_to_sheet(detallesData);
                        XLSX.utils.book_append_sheet(wb, wsDetalles, "üìä Detalles T√©cnicos");
                    }
                    
                    // Generar nombre de archivo
                    const tiposNombre = {
                        'completo': 'completo',
                        'pagos': 'pagados',
                        'vencidos': 'vencidos_urgente',
                        'seguimiento': 'seguimiento_ia'
                    };
                    
                    const nombreArchivo = `reporte_${tiposNombre[tipo]}_${Date.now()}.xlsx`;
                    
                    // Descargar Excel
                    XLSX.writeFile(wb, nombreArchivo);
                    
                    // Mostrar resumen
                    const resumenPopup = `üìä REPORTE EXCEL GENERADO

‚úÖ ARCHIVO DESCARGADO:
${nombreArchivo}

üìã CONTENIDO:
${tipo === 'completo' ? '‚Ä¢ Resumen ejecutivo completo\n‚Ä¢ Datos completos de cartera\n‚Ä¢ Estad√≠sticas detalladas' : 
  tipo === 'pagos' ? '‚Ä¢ Lista de clientes pagados\n‚Ä¢ Montos y estad√≠sticas\n‚Ä¢ An√°lisis de efectividad' :
  tipo === 'vencidos' ? '‚Ä¢ Clientes vencidos urgentes\n‚Ä¢ Montos por recuperar\n‚Ä¢ Plan de acci√≥n inmediata' :
  '‚Ä¢ Estad√≠sticas de IA\n‚Ä¢ Env√≠os autom√°ticos\n‚Ä¢ Optimizaci√≥n inteligente'}

üìû CONFIGURACI√ìN DE AVISOS:
‚Ä¢ WhatsApp sale desde: +506 6045-7989
‚Ä¢ Email sale desde: sistema@tonyvillalobos.cr
‚Ä¢ Frecuencia: Cada 24 horas
‚Ä¢ Soporte: Tony Villalobos 6045-7989

${tipo === 'vencidos' ? '\nüö® ACCI√ìN REQUERIDA:\n‚Ä¢ ' + vencidos.length + ' clientes requieren contacto inmediato\n‚Ä¢ Monto por recuperar: ‚Ç°' + montoVencidos.toLocaleString() : ''}`;

                    alert(resumenPopup);
                    mostrarNotificacion('‚úÖ Reporte Excel descargado: ' + nombreArchivo, 'success');
                    mostrarNotificacion('üìû Avisos salen desde: +506 6045-7989', 'info');
                    
                } catch (error) {
                    console.error('Error generando reporte:', error);
                    mostrarNotificacion('‚ùå Error generando reporte: ' + error.message, 'error');
                    
                    // Fallback a informaci√≥n b√°sica
                    const infoBasica = `üìä REPORTE ${tipo.toUpperCase()}

üìã DATOS B√ÅSICOS:
‚Ä¢ Total clientes: ${datosReales.length}
‚Ä¢ Reportes detallados requieren datos completos

üìû CONFIGURACI√ìN AVISOS:
‚Ä¢ WhatsApp: +506 6045-7989 (Tony)
‚Ä¢ Email: sistema@tonyvillalobos.cr
‚Ä¢ Soporte: Tony Villalobos

‚ùå Para reportes Excel completos, verifica que tu archivo tenga todos los campos necesarios.`;
                    
                    alert(infoBasica);
                }
            }, 1500);
        }
        
        // ===== ASEGURAR DISPONIBILIDAD GLOBAL =====
        window.cambiarTab = cambiarTab;
        window.mostrarNotificacion = mostrarNotificacion;
        window.procesarArchivoReal = procesarArchivoReal;
        window.cargarDatosReales = cargarDatosReales;
        window.toggleSistema = toggleSistema;
        window.limpiarSistema = limpiarSistema;
        window.exportarExcel = exportarExcel;
        window.generarReporte = generarReporte;
        window.accionCliente = accionCliente;
        
        console.log('‚úÖ SISTEMA V5 PROFESIONAL - FUNCIONES GLOBALES CARGADAS');
    </script>

    <div class="container">
        <div class="demo-banner">
            üèÜ SISTEMA V5 - AUTOMATIZACI√ìN EXCLUSIVA PARA CORREDORES DE SEGUROS üèÜ
        </div>

        <div class="header">
            <div class="pro-badge">V5 PRO</div>
            <h1>üíº Sistema de Cobros V5 para Corredores</h1>
            <p>Tony Villalobos - Especialista en Automatizaci√≥n del Sector Asegurador</p>
            <div class="developer-info">
                Corredor a Corredor | WhatsApp: 6045-7989
            </div>
        </div>

        <div class="contact-section">
            <h3>üöÄ DISE√ëADO EXCLUSIVAMENTE PARA CORREDORES</h3>
            <p>Automatiza tu cobranza manteniendo la relaci√≥n personal con tus clientes. Aumenta hasta 40% tu efectividad.</p>
            <a href="https://wa.me/50660457989?text=Hola%20Tony,%20soy%20corredor%20de%20seguros%20y%20necesito%20automatizar%20mi%20cobranza" class="whatsapp-btn">
                üí¨ Consulta de Corredor a Corredor
            </a>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="cambiarTab('dashboard')">üìä Dashboard</button>
            <button class="nav-tab" onclick="cambiarTab('carga')">üì• Cargar Datos</button>
            <button class="nav-tab" onclick="cambiarTab('cartera')">üìã Cartera</button>
            <button class="nav-tab" onclick="cambiarTab('seguimiento')">ü§ñ IA</button>
            <button class="nav-tab" onclick="cambiarTab('reportes')">üìà Reportes</button>
            <button class="nav-tab" onclick="cambiarTab('contacto')">üìû Contacto</button>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <h2>üìä Dashboard Principal</h2>
            
            <div class="alert alert-success">
                <h4>üéØ SISTEMA PROFESIONAL V5</h4>
                <p>‚Ä¢ <strong>Automatizaci√≥n completa</strong> - Env√≠os inteligentes 24/7<br>
                ‚Ä¢ <strong>IA integrada</strong> - Optimizaci√≥n continua de mensajes<br>
                ‚Ä¢ <strong>Reportes avanzados</strong> - An√°lisis detallado de cobranza</p>
            </div>

            <div class="alert alert-info">
                <h4>üìû TU CONFIGURACI√ìN PERSONALIZADA</h4>
                <p><strong>En tu sistema personalizado, los mensajes saldr√°n desde:</strong></p>
                <p>‚Ä¢ üì± <strong>WhatsApp:</strong> TU n√∫mero de corredor personal<br>
                ‚Ä¢ üìß <strong>Email:</strong> tu-nombre@tu-agencia.com<br>
                ‚Ä¢ üîÑ <strong>Frecuencia:</strong> La que T√ö definas (24h, 48h, semanal)<br>
                ‚Ä¢ üìä <strong>Horarios:</strong> Optimizados para TUS clientes espec√≠ficos<br>
                ‚Ä¢ üéØ <strong>Mensajes:</strong> Personalizados con TU nombre y agencia<br>
                ‚Ä¢ üìû <strong>Soporte:</strong> Configuraci√≥n e instalaci√≥n personalizada</p>
                <p style="margin-top: 10px; font-weight: bold; color: #27ae60;">
                    Tus clientes siempre te reconocer√°n como SU corredor de confianza.
                </p>
            </div>

            <div class="alert alert-warning" id="estadoSistema">
                <h4>‚ÑπÔ∏è SISTEMA SIN DATOS</h4>
                <p>Para empezar:</p>
                <p><strong>1.</strong> Ve a "üì• Cargar Datos" ‚Üí <strong>2.</strong> Sube tu Excel ‚Üí <strong>3.</strong> ¬°Listo!</p>
            </div>
            
            <div class="seguimiento-card">
                <h3>ü§ñ Sistema de Seguimiento Autom√°tico</h3>
                <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px;">
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <button id="pausePlayBtn" class="upload-btn" onclick="toggleSistema()" style="background: #e74c3c; margin: 0;">
                            ‚ñ∂Ô∏è ACTIVAR SISTEMA
                        </button>
                        <span id="statusText" style="font-weight: bold; color: #e74c3c;">üî¥ SISTEMA PAUSADO</span>
                    </div>
                    <div>
                        <button class="upload-btn" style="background: #ff6b6b; font-size: 12px; padding: 8px 15px; margin: 0;" onclick="limpiarSistema()">üóëÔ∏è Borrar Base</button>
                    </div>
                </div>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 20px;">
                    <div style="text-align: center;">
                        <div style="font-size: 2em; font-weight: bold;" id="estadoSistemaText">PAUSADO</div>
                        <div style="opacity: 0.8;">Estado</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 2em; font-weight: bold;" id="totalClientes">0</div>
                        <div style="opacity: 0.8;">Clientes</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 2em; font-weight: bold;" id="mensajesEnviados">0</div>
                        <div style="opacity: 0.8;">Mensajes</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 2em; font-weight: bold;" id="efectividad">0%</div>
                        <div style="opacity: 0.8;">Efectividad</div>
                    </div>
                </div>
            </div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="statTotalClientes">0</div>
                    <div class="stat-label">Total Clientes</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="statCarteraTotal">‚Ç°0</div>
                    <div class="stat-label">Cartera Total</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="statPendienteCobro">‚Ç°0</div>
                    <div class="stat-label">Pendiente Cobro</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="statTasaCobro">0%</div>
                    <div class="stat-label">Tasa de Cobro</div>
                </div>
            </div>
        </div>

        <!-- Tab Carga de Datos -->
        <div id="carga" class="tab-content">
            <h2>üì• Carga de Datos</h2>
            
            <div class="alert alert-success">
                <h4>‚úÖ CARGA INTELIGENTE DE DATOS</h4>
                <p>Sube tu Excel en cualquier formato. El sistema detecta autom√°ticamente los campos y optimiza la estructura.</p>
                <p><strong>üóëÔ∏è Borrar Base:</strong> Elimina todos los datos y resetea el sistema completamente.</p>
            </div>
            
            <div style="border: 3px dashed #27ae60; border-radius: 10px; padding: 40px; text-align: center; margin: 30px 0;">
                <h3>üìÅ Sube tu Excel aqu√≠</h3>
                <p style="color: #666; margin: 20px 0;">Acepta: .xlsx, .xls, .csv</p>
                <input type="file" id="fileInput" accept=".xlsx,.xls,.csv" style="display: none;" onchange="procesarArchivoReal(this)">
                <button class="upload-btn" onclick="document.getElementById('fileInput').click()">üìä Seleccionar Archivo</button>
            </div>

            <div id="procesoResultado" style="display: none;">
                <div class="alert alert-info">
                    <h4>üìã ARCHIVO PROCESADO</h4>
                    <p>Se detectaron <strong id="clientesDetectados">0</strong> clientes.</p>
                    <div id="camposDetectados"></div>
                </div>
                
                <div style="display: flex; justify-content: center; gap: 15px; margin: 30px 0;">
                    <button class="upload-btn" style="background: #27ae60;" onclick="cargarDatosReales()">‚úÖ Cargar al Sistema</button>
                    <button class="upload-btn" style="background: #e74c3c;" onclick="limpiarSistema()">üóëÔ∏è Borrar Base</button>
                </div>
            </div>
        </div>

        <!-- Tab Cartera -->
        <div id="cartera" class="tab-content">
            <h2>üìã Gesti√≥n de Cartera</h2>
            
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 10px;">
                <div>
                    <button class="upload-btn" onclick="exportarExcel()">üìä Exportar Excel</button>
                    <button class="upload-btn" style="background: #e74c3c;" onclick="mostrarNotificacion('üì± En producci√≥n: WhatsApp autom√°tico desde TU n√∫mero configurado', 'info')">üì± WhatsApp Masivo</button>
                    <button class="upload-btn" style="background: #9b59b6;" onclick="mostrarNotificacion('üìß En producci√≥n: Emails desde TU dominio personalizado', 'info')">üìß Email Masivo</button>
                </div>
                <div style="display: flex; align-items: center; gap: 15px;">
                    <button class="upload-btn" style="background: #ff6b6b; font-size: 14px; padding: 10px 20px;" onclick="limpiarSistema()">üóëÔ∏è Borrar Base</button>
                    <span style="font-size: 14px; color: #666;">Total: <strong id="contadorClientes">0 clientes</strong></span>
                </div>
            </div>

            <div class="alert alert-info">
                <h4>üìû CONFIGURACI√ìN PERSONALIZADA (En Tu Sistema Real)</h4>
                <p><strong>En tu instalaci√≥n personalizada, los avisos saldr√°n desde:</strong><br>
                üì± <strong>WhatsApp:</strong> TU n√∫mero de corredor personal | 
                üìß <strong>Email:</strong> tu-nombre@tu-agencia.com<br>
                <small>Tus clientes recibir√°n mensajes directamente de TI como su corredor de confianza.</small></p>
            </div>

            <div class="alert alert-warning">
                <h4>üóëÔ∏è GESTI√ìN DE DATOS</h4>
                <p>Usa <strong>"Borrar Base"</strong> para eliminar completamente todos los datos cargados y resetear el sistema al estado inicial. 
                <strong>Esta acci√≥n no se puede deshacer.</strong></p>
            </div>

            <div class="alert alert-info" style="background: #fff3cd; color: #856404; border: 1px solid #ffeaa7;">
                <h4>üéØ ESTA ES UNA DEMOSTRACI√ìN</h4>
                <p>Los botones de WhatsApp y Email muestran ejemplos. <strong>En tu sistema real:</strong></p>
                <ul style="text-align: left; margin-top: 10px;">
                    <li>‚úÖ Los mensajes se env√≠an autom√°ticamente desde TU WhatsApp</li>
                    <li>‚úÖ Los emails salen desde TU dominio personalizado</li>
                    <li>‚úÖ Tus clientes te reconocen como SU corredor de seguros</li>
                    <li>‚úÖ Mantienes la relaci√≥n personal y profesional</li>
                </ul>
            </div>

            <div style="overflow-x: auto;">
                <table class="data-table" id="tablaCartera">
                    <thead>
                        <tr>
                            <th>Cliente</th>
                            <th>Score IA</th>
                            <th>P√≥liza</th>
                            <th>Monto</th>
                            <th>Vencimiento</th>
                            <th>Estado</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td colspan="7" style="text-align: center; color: #666; padding: 40px;">
                                üì• No hay datos cargados. Ve a "Cargar Datos" para subir tu Excel.
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Tab Seguimiento -->
        <div id="seguimiento" class="tab-content">
            <h2>ü§ñ Sistema de Seguimiento IA</h2>
            
            <div class="seguimiento-card">
                <h3>‚öôÔ∏è Configuraci√≥n Inteligente</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 20px;">
                    <div style="text-align: center; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 10px;">
                        <div style="font-size: 2em; font-weight: bold;">24h</div>
                        <div style="font-size: 14px;">Intervalo Inicial</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 10px;">
                        <div style="font-size: 2em; font-weight: bold;">89%</div>
                        <div style="font-size: 14px;">Efectividad IA</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 10px;">
                        <div style="font-size: 2em; font-weight: bold;">15</div>
                        <div style="font-size: 14px;">M√°ximo Intentos</div>
                    </div>
                </div>
            </div>

            <div class="alert alert-info">
                <h4>üß† INTELIGENCIA ARTIFICIAL PARA CORREDORES DE SEGUROS</h4>
                <p><strong>El sistema se adapta a TU forma de trabajar:</strong></p>
                <ul style="text-align: left; margin-top: 10px;">
                    <li>üïí <strong>Horarios:</strong> Aprende cu√°ndo TUS clientes responden mejor</li>
                    <li>üì± <strong>WhatsApp desde:</strong> TU n√∫mero personal de corredor</li>
                    <li>üìß <strong>Emails desde:</strong> TU dominio profesional</li>
                    <li>üéØ <strong>Mensajes personalizados:</strong> Con TU nombre y agencia</li>
                    <li>üìä <strong>Priorizaci√≥n:</strong> Seg√∫n tipos de p√≥liza que T√ö manejas</li>
                    <li>üîÑ <strong>Escalamiento:</strong> Respeta TU relaci√≥n con cada cliente</li>
                </ul>
                <p style="margin-top: 10px; font-weight: bold; color: #27ae60;">
                    La IA potencia TU trabajo, no lo reemplaza.
                </p>
            </div>
        </div>

        <!-- Tab Reportes -->
        <div id="reportes" class="tab-content">
            <h2>üìà Reportes y Estad√≠sticas</h2>
            
            <div style="display: flex; gap: 15px; margin-bottom: 30px; flex-wrap: wrap;">
                <button class="upload-btn" onclick="generarReporte('completo')">üìä Reporte Completo</button>
                <button class="upload-btn" style="background: #27ae60;" onclick="generarReporte('pagos')">üí∞ Pagos</button>
                <button class="upload-btn" style="background: #e74c3c;" onclick="generarReporte('vencidos')">‚ö†Ô∏è Vencidos</button>
                <button class="upload-btn" style="background: #9b59b6;" onclick="generarReporte('seguimiento')">ü§ñ Seguimiento IA</button>
            </div>

            <div class="stats-grid">
                <div class="stat-card" style="border-left-color: #27ae60;">
                    <div class="stat-number" style="color: #27ae60;">0</div>
                    <div class="stat-label">Pagados este mes</div>
                </div>
                <div class="stat-card" style="border-left-color: #e74c3c;">
                    <div class="stat-number" style="color: #e74c3c;">0</div>
                    <div class="stat-label">Vencidos sin pagar</div>
                </div>
                <div class="stat-card" style="border-left-color: #f39c12;">
                    <div class="stat-number" style="color: #f39c12;">0</div>
                    <div class="stat-label">Pr√≥ximos a vencer</div>
                </div>
                <div class="stat-card" style="border-left-color: #3498db;">
                    <div class="stat-number" style="color: #3498db;">0</div>
                    <div class="stat-label">Mensajes enviados</div>
                </div>
            </div>
        </div>

        <!-- Tab Contacto -->
        <div id="contacto" class="tab-content">
            <div style="text-align: center; padding: 40px;">
                <h2>üìû Contacto Especializado para Corredores de Seguros</h2>
                
                <div style="background: white; padding: 30px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); max-width: 600px; margin: 0 auto;">
                    <h3>üë®‚Äçüíº Tony Villalobos Barrantes</h3>
                    <p style="color: #27ae60; font-weight: bold; margin: 10px 0;">Especialista en Automatizaci√≥n para Corredores de Seguros</p>
                    <p style="color: #666; margin: 15px 0;">Sistema V5 dise√±ado exclusivamente para profesionales del sector asegurador en Costa Rica</p>
                    
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin: 20px 0; text-align: left;">
                        <h4 style="color: #2c3e50; margin-bottom: 15px;">üéØ Especializaci√≥n en Cobranza de Seguros:</h4>
                        <ul style="color: #666; line-height: 1.6;">
                            <li>‚úÖ <strong>Automatizaci√≥n de cobranza</strong> para p√≥lizas de vida, auto, hogar</li>
                            <li>‚úÖ <strong>Integraci√≥n con aseguradoras</strong> INS, Mapfre, Assa, BCR Seguros</li>
                            <li>‚úÖ <strong>Mensajer√≠a personalizada</strong> seg√∫n tipo de p√≥liza y cliente</li>
                            <li>‚úÖ <strong>Reportes especializados</strong> para corredores y agencias</li>
                            <li>‚úÖ <strong>Cumplimiento SUGESE</strong> y normativas del sector</li>
                        </ul>
                    </div>
                    
                    <div style="font-size: 1.1em; margin: 20px 0; background: #e8f5e8; padding: 15px; border-radius: 8px;">
                        <p><strong>üì± WhatsApp Directo:</strong> +506 6045-7989</p>
                        <p><strong>üìß Email Especializado:</strong> tony@sistemaseguros.cr</p>
                        <p><strong>üïí Atenci√≥n:</strong> Lunes a Viernes 8AM-6PM</p>
                        <p><strong>üá®üá∑ Ubicaci√≥n:</strong> San Jos√©, Costa Rica</p>
                    </div>
                    
                    <a href="https://wa.me/50660457989?text=Hola%20Tony,%20soy%20corredor%20de%20seguros%20y%20me%20interesa%20el%20Sistema%20V5%20para%20automatizar%20mi%20cobranza" class="whatsapp-btn" style="font-size: 1.1em; padding: 15px 30px;">üí¨ Contacto de Corredor a Corredor</a>
                </div>
                
                <div class="contact-section" style="margin-top: 30px;">
                    <h3>üöÄ Sistema V5 - Exclusivo para Corredores</h3>
                    <p><strong>Automatiza tu cobranza profesionalmente.</strong> Aumenta hasta 40% tu efectividad manteniendo la relaci√≥n personal con tus clientes.</p>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 20px 0; text-align: left;">
                        <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px;">
                            <h4>üíº Para Corredores Independientes</h4>
                            <p style="font-size: 14px;">Maneja tu cartera personal con herramientas profesionales</p>
                        </div>
                        <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px;">
                            <h4>üè¢ Para Agencias de Seguros</h4>
                            <p style="font-size: 14px;">Coordina m√∫ltiples corredores y equipos de trabajo</p>
                        </div>
                        <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px;">
                            <h4>üìä Para Gerentes Comerciales</h4>
                            <p style="font-size: 14px;">Supervisa y optimiza resultados de cobranza</p>
                        </div>
                    </div>
                    
                    <a href="https://wa.me/50660457989?text=Tony,%20necesito%20una%20demo%20personalizada%20del%20Sistema%20V5%20para%20mi%20operaci√≥n%20de%20seguros" class="whatsapp-btn" style="font-size: 1.3em; padding: 20px 50px;">
                        üéØ ¬°Solicitar Demo Personalizada!
                    </a>
                    
                    <p style="margin-top: 15px; font-size: 14px; opacity: 0.9;">
                        <strong>‚ö° Instalaci√≥n en 24 horas</strong> | <strong>üìã Capacitaci√≥n incluida</strong> | <strong>üõ†Ô∏è Soporte permanente</strong>
                    </p>
                </div>
                
                <div style="background: white; padding: 20px; border-radius: 10px; margin-top: 30px; max-width: 500px; margin-left: auto; margin-right: auto;">
                    <h4 style="color: #2c3e50;">üèÜ Testimonios de Corredores</h4>
                    <div style="text-align: left; font-style: italic; color: #666; font-size: 14px; margin: 15px 0;">
                        <p>"Desde que uso el Sistema V5, mi cobranza mejor√≥ 35%. Mis clientes reciben recordatorios puntuales y yo me enfoco en vender m√°s p√≥lizas." - <strong>Mar√≠a Gonz√°lez, Corredor INS</strong></p>
                        <p style="margin-top: 10px;">"La automatizaci√≥n me ahorra 10 horas semanales. El sistema mantiene la relaci√≥n personal que necesitan mis clientes." - <strong>Carlos Rodr√≠guez, Agencia Mapfre</strong></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ===== INICIALIZACI√ìN Y VERIFICACI√ìN =====
        
        function inicializarSistema() {
            console.log('üöÄ INICIALIZANDO SISTEMA V5 PROFESIONAL...');
            
            // Verificar que las funciones est√©n disponibles
            const funcionesEsenciales = ['cambiarTab', 'mostrarNotificacion', 'procesarArchivoReal'];
            const faltantes = funcionesEsenciales.filter(func => typeof window[func] !== 'function');
            
            if (faltantes.length > 0) {
                console.error('‚ùå Funciones faltantes:', faltantes);
                alert('‚ùå ERROR: Algunas funciones no est√°n disponibles. Recarga la p√°gina.');
                return;
            }
            
            console.log('‚úÖ Todas las funciones esenciales disponibles');
            mostrarNotificacion('üöÄ Sistema V5 iniciado correctamente', 'success');
            
            // Verificar navegaci√≥n
            setTimeout(() => {
                try {
                    const tabsButtons = document.querySelectorAll('.nav-tab');
                    console.log(`üìã Encontrados ${tabsButtons.length} botones de navegaci√≥n`);
                    
                    const tabsContent = document.querySelectorAll('.tab-content');
                    console.log(`üìÑ Encontradas ${tabsContent.length} pesta√±as de contenido`);
                    
                    if (tabsButtons.length > 0 && tabsContent.length > 0) {
                        mostrarNotificacion('‚úÖ Sistema completamente operativo', 'success');
                    } else {
                        console.warn('‚ö†Ô∏è Problema con elementos de navegaci√≥n');
                    }
                } catch (error) {
                    console.error('‚ùå Error verificando navegaci√≥n:', error);
                }
            }, 1000);
            
            // Notificaci√≥n de bienvenida
            setTimeout(() => {
                mostrarNotificacion('üíº Listo para automatizar tu cobranza', 'info');
            }, 2000);
        }
        
        // Funci√≥n de debugging para el usuario
        window.verificarSistema = function() {
            console.log('üîç VERIFICACI√ìN DEL SISTEMA:');
            console.log('- cambiarTab:', typeof cambiarTab);
            console.log('- mostrarNotificacion:', typeof mostrarNotificacion);
            console.log('- procesarArchivoReal:', typeof procesarArchivoReal);
            console.log('- Datos cargados:', datosReales.length);
            console.log('- Sistema activo:', sistemaActivo);
            
            const resultado = `
üîç ESTADO DEL SISTEMA:
‚úÖ Navegaci√≥n: ${typeof cambiarTab === 'function' ? 'OK' : 'ERROR'}
‚úÖ Notificaciones: ${typeof mostrarNotificacion === 'function' ? 'OK' : 'ERROR'}  
‚úÖ Carga archivos: ${typeof procesarArchivoReal === 'function' ? 'OK' : 'ERROR'}
üìä Datos: ${datosReales.length} registros
ü§ñ Estado: ${sistemaActivo ? 'ACTIVO' : 'PAUSADO'}
            `;
            
            alert(resultado);
            return resultado;
        };
        
        // Agregar estilos de animaci√≥n
        const estilosAnimacion = document.createElement('style');
        estilosAnimacion.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            
            .nav-tab {
                transition: all 0.3s ease;
            }
            
            .nav-tab:hover {
                transform: translateY(-2px);
            }
            
            .upload-btn:hover {
                box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            }
        `;
        document.head.appendChild(estilosAnimacion);
        
        // Inicializar cuando el DOM est√© listo
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', inicializarSistema);
        } else {
            inicializarSistema();
        }
        
        // Backup de inicializaci√≥n
        window.addEventListener('load', function() {
            setTimeout(() => {
                if (typeof cambiarTab !== 'function') {
                    console.warn('‚ö†Ô∏è Funci√≥n cambiarTab no disponible, redefiniendola...');
                    window.cambiarTab = function(tabName) {
                        try {
                            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
                            document.querySelectorAll('.nav-tab').forEach(button => button.classList.remove('active'));
                            
                            const targetTab = document.getElementById(tabName);
                            if (targetTab) targetTab.classList.add('active');
                            
                            const activeButton = document.querySelector(`button[onclick*="${tabName}"]`);
                            if (activeButton) activeButton.classList.add('active');
                            
                            mostrarNotificacion('üìã Navegando a: ' + tabName, 'info');
                        } catch (error) {
                            console.error('Error en cambiarTab backup:', error);
                        }
                    };
                    console.log('‚úÖ Funci√≥n cambiarTab redefinida como backup');
                }
            }, 500);
        });
        
        console.log('üéØ SISTEMA V5 PROFESIONAL - LISTO PARA PRODUCCI√ìN');
    </script>
</body>
</html>
